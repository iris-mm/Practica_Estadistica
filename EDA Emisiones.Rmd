---
title: "Práctica 1: Estadística descriptiva"
date: "Estadística - Curso 2024/2025"

output: 
  html_document:
    toc: yes
    toc_float: yes

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      warning = FALSE,
                      message = FALSE)
```

# 1. Introducción y definición de objetos

## 1.1 Objetivo de la investigación

El objetivo de esta investigación es determinar la forma en que algunas características de distintos vehículos como son su tamaño, peso o potencia de motor; influyen en las emisiones que liberan al medioambiente.\
Para ello nos basamos en datos recogidos en España a lo largo de 2022.

## 1.2. Variables excluidas
Antes de comenzar el análisis, se han descartado 6 de las 26 variables que ofrece el dataset, ya que no se consideran relevantes para el estudio o contienen una muestra de datos demasiado pequeña. Las variables excluidas son las siguientes:

- **ID**: Es un identificador que no aporta valor al análisis de emisiones.
- **Total seating**: Se cubre mediante otras variables que ya proporcionan suficiente información acerca de las dimensiones del vehículo.
- **CO2/km emissions in WLTP** y **Consumption l/100km in WLTP**: Estas variables han sido descartadas ya que el dataset ofrece otras similares que resultan más útiles para el estudio (como el consumo máximo y mínimo de combustible y las emisiones de CO2).
- **Type hybrid**: Esta variable ha sido excluida debido a la falta de suficientes datos para que sea relevante en el análisis.


## 1.3. Nueva variable: Área frontal

Con el objetivo de optimizar el análisis de las dimensiones del vehículo, se decidió crear una nueva variable denominada "frontal area". Esta variable se calcula a partir de las dimensiones de ancho y alto del vehículo (descartando la longitud). La **área frontal** es una medida que ayuda a analizar cómo las dimensiones del vehículo influyen en su resistencia aerodinámica, lo cual tiene un impacto directo en el consumo de combustible y las emisiones. Los vehículos con mayor área frontal ejercen más resistencia al viento, lo que aumenta la necesidad de energía y, por tanto, incrementa las emisiones.


# 2. Importación de datos y carga de paquetes
```{r}
library(tidyverse)
library(summarytools)
library(ggplot2)
library(readxl)
library(dplyr)
library(knitr)
library(reshape2)
library(corrplot)
emisiones <- readxl::read_excel("idae_emissions.xlsx")
```

# 3. Diccionario de Datos

## 3.1. Descripción de las variables

- `ID`: Identificador del coche (identificador)
- `Model`: Modelo del coche (categórica multinivel)
- `Engine type`: Tipo de motor (categórica multinivel)
- `Max Consumption l/100km`: Máxima consumición de combustible en l cada 100km (numérica continua)
- `Max emissions gCO2/km`: Máxima consumición de combustible en l cada 100km (numérica continua)
- `Engine displacement cm3`: Cilindrada del motor en cm3 (numérica discreta)
- `Power ice kw`: Potencia del motor en combustión interna en kw (numérica discreta)
- `Battery range km`: Autonomía de la batería en km (numérica discreta)
- `CO2/km emissions in WLTP`: Emisiones de CO2 según el ciclo de prueba WLTP en g/km (numérica continua)
- `Width in mm`: Ancho del vehículo en mm (numérica continua)
- `Gross vehicle weight in kg`: M.m.a del vehículo en kg (numérica continua)
- `Fuel economy index`: Índice de eficiencia del vehículo (categórica multinivel; A,B,C,D,E,F,G,N/A)
- `Electric consumption kwh/100km`: Consumo de energía eléctrica cada 100km en kwh (numérica continua)
- `Market segment`: Tipo de vehículo (categórica multinivel)
- `Min consumption l/100km`: Mínima consumición de combustible en l cada 100km (numérica continua)
- `Min emissions gCO2/km`: Emisiones mínimas de CO2 en g/km (numérica continua)
- `Transmission`: Nivel de transmisión del vehículo (categórica ordinal; Manual-M, Semiautomática-SC, Automática-A)
- `Power CV`: Potencia del motor en CV (numérica continua)
- `Power electric kw`: Potencia del motor eléctrico en kw (numérica continua)
- `Consumption l/100km in WLTP`: Consumo de combustible según el ciclo de prueba WLTP en g/km (numérica continua)
- `Length in mm`: Largo del vehículo en mm (numérica continua)
- `Height in mm`: Altura del vehículo en mm (numérica continua)
- `Total seating`: Número de asientos del vehículo (numérica discreta)
- `Type hybrid`: Tipo de híbrido (categórica dicotómica; Enchufable/Convencional)
- `Battery capacity kwh`: Capacidad de la batería en kwh (númerica continua)

## 3.2. Definición de la variable "Frontal area"

```{r}
emisiones <- emisiones %>%
  mutate(area_frontal_m2 = (width_mm / 1000) * (height_mm / 1000))

```
La variable frontal area nos proporciona información sobre la aerodinámica de los vehículos. Los que tengan una mayor área frontal ejercerán más resistencia contra el viento, haciendo que necesiten más energía para moverse y por tanto quemen más combustible.

# 4. Análisis exploratorio de datos

## 4.1. Análisis univariado

### 4.1.1. Distribución de máximas emisiones de CO2

```{r}
ggplot(emisiones, aes(x = `emissions_max_gCO2_km`)) +
  geom_histogram(binwidth = 10, fill = "skyblue", color = "black") +
  labs(title = "Distribución de Máximas Emisiones de CO2 (g/km)",
       x = "Max emissions gCO2/km",
       y = "Frecuencia") +
  theme_minimal()
```

### 4.1.2. Tipificación de las variables numéricas
```{r}
emisiones_tipificadas <- emisiones %>%
  mutate(
    Max_emissions_z = scale(`emissions_max_gCO2_km`),
    Max_Consumption_z = scale(`consumption_max_l_100km`),
    Power_ice_z = scale(`power_ice_kw`),
    Gross_vehicle_weight_z = scale(`gross_vehicle_weight_rating_kg`),
    Battery_range_z = scale(`battery_range_km`),
    area_frontal_z = scale(area_frontal_m2)
  )
```

### 4.1.3 Cálculo de media y mediana de emisiones
```{r}
mean_emissions <- mean(emisiones$`emissions_max_gCO2_km`, na.rm = TRUE)
median_emissions <- median(emisiones$`emissions_max_gCO2_km`, na.rm = TRUE)

mean_emissions
median_emissions
```


### 4.1.4 Resumen estadístico de variables relevantes
```{r}
resumen <- emisiones %>%
  summarise(
    Max_Consumption_mean = mean(`consumption_max_l_100km`, na.rm = TRUE),
    Max_Consumption_sd = sd(`consumption_max_l_100km`, na.rm = TRUE),
    Max_Emissions_mean = mean(`emissions_max_gCO2_km`, na.rm = TRUE),
    Max_Emissions_sd = sd(`emissions_max_gCO2_km`, na.rm = TRUE),
    Power_mean = mean(`power_ice_kw`, na.rm = TRUE),
    Power_sd = sd(`power_ice_kw`, na.rm = TRUE),
    Weight_mean = mean(`gross_vehicle_weight_rating_kg`, na.rm = TRUE),
    Weight_sd = sd(`gross_vehicle_weight_rating_kg`, na.rm = TRUE)
  )

resumen
```


## 4.2 Análisis bivariado

### 4.2.1 Gráfico de la distribución del Índice de Eficiencia del Combustible
```{r}
ggplot(emisiones, aes(x = `fuel_economy_index`)) +
  geom_bar(fill = "purple", color = "black") +
  labs(title = "Distribución del Índice de Eficiencia del Combustible",
       x = "Índice de Eficiencia",
       y = "Frecuencia") +
  theme_minimal()
```

### 4.2.2 Tabla de frecuencias para "Fuel economy index"
```{r}
tabla_frecuencias_fuel_economy <- table(emisiones$`fuel_economy_index`)
print(tabla_frecuencias_fuel_economy)
```

### 4.2.3 Tabla de frecuencias para "Engine type"
```{r}
tabla_frecuencias_engine_type <- table(emisiones$`engine_type`)
print(tabla_frecuencias_engine_type)
```


### 4.2.4 Visualización de las tablas de frecuencias

#### 4.2.4.1 Gráfico de barras para el índice de eficiencia de combustible
```{r}
ggplot(as.data.frame(tabla_frecuencias_fuel_economy), aes(x = Var1, y = Freq)) +
  geom_bar(stat = "identity", fill = "lightblue") +
  labs(title = "Frecuencia del Índice de Eficiencia de Combustible",
       x = "Índice de Eficiencia",
       y = "Frecuencia") +
  theme_minimal()
```

#### 4.2.4.2 Gráfico de barras para el tipo de motor
```{r}
ggplot(as.data.frame(tabla_frecuencias_engine_type), aes(x = Var1, y = Freq)) +
  geom_bar(stat = "identity", fill = "orange") +
  labs(title = "Frecuencia del Tipo de Motor",
       x = "Tipo de Motor",
       y = "Frecuencia") +
  theme_minimal()
```


### 4.2.5 Gráficos de dispersión
```{r}
ggplot(emisiones, aes(x = `power_ice_kw`, y = `emissions_max_gCO2_km`)) +
  geom_point(color = "red", size = 2) +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  labs(title = "Relación entre Potencia del motor y Emisiones de CO2",
       x = "Potencia del Motor (kw)",
       y = "Max emissions gCO2/km") +
  theme_minimal()
```

#### 4.2.5.1 Potencia (kw) vs Máximas emisiones de CO2
```{r}
cor_power_emissions <- cor(emisiones$`power_ice_kw`, emisiones$`emissions_max_gCO2_km`, use = "complete.obs")
cor_power_emissions

```

##### Modelo de regresión lineal
```{r}
modelo <- lm(`emissions_max_gCO2_km` ~ `power_ice_kw`, data = emisiones)
summary(modelo)
```


#### 4.2.5.2 Área frontal vs Consumo máximo
```{r}
ggplot(emisiones, aes(x = area_frontal_m2, y = `consumption_max_l_100km`)) +
  geom_point(color = "darkgreen", size = 2) +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  labs(title = "Relación entre Área Frontal y Consumo Máximo de Combustible",
       x = "Área Frontal (m2)",
       y = "Max Consumption l/100km") +
  theme_minimal()
```


#### 4.2.5.3 Peso del vehículo vs Máximas emisiones de CO2
```{r}
ggplot(emisiones, aes(x = `gross_vehicle_weight_rating_kg`, y = `emissions_max_gCO2_km`)) +
  geom_point(color = "purple", size = 2) +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  labs(title = "Relación entre Peso del Vehículo y Emisiones de CO2",
       x = "Peso del Vehículo (kg)",
       y = "Max emissions gCO2/km") +
  theme_minimal()
```


#### 4.2.5.4 Cilindrada del motor vs Máximas emisiones de CO2
```{r}
ggplot(emisiones, aes(x = `engine_displacement_cm3`, y = `emissions_max_gCO2_km`)) +
  geom_point(color = "cyan", size = 2) +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  labs(title = "Relación entre Cilindrada del Motor y Emisiones de CO2",
       x = "Cilindrada del Motor (cm3)",
       y = "Max emissions gCO2/km") +
  theme_minimal()

```

### 4.2.6 Gráficos de boxplot
#### 4.2.6.1 Emisiones según el índice de eficiencia de combustible
```{r}
ggplot(emisiones, aes(x = `fuel_economy_index`, y = `emissions_max_gCO2_km`, fill = `fuel_economy_index`)) +
  geom_boxplot() +
  labs(title = "Emisiones de CO2 por Índice de Eficiencia de Combustible",
       x = "Índice de Eficiencia",
       y = "Max emissions gCO2/km") +
  theme_minimal()
```

#### 4.2.6.2 Emisiones según el tipo de motor
```{r}
ggplot(emisiones, aes(x = `engine_type`, y = `emissions_max_gCO2_km`, fill = `engine_type`)) +
  geom_boxplot() +
  labs(title = "Emisiones de CO2 por Tipo de Motor",
       x = "Tipo de Motor",
       y = "Max emissions gCO2/km") +
  theme_minimal()
```


### 4.2.7 Correlación entre potencia y emisiones
cor_power_emissions <- cor(emisiones$`power_ice_kw`, emisiones$`emissions_max_gCO2_km`, use = "complete.obs")
cor_power_emissions


### 4.2.8 Modelo de regresión lineal

```{r}
modelo <- lm(`emissions_max_gCO2_km` ~ `power_ice_kw`, data = emisiones)
summary(modelo)
```

# 5. Conclusiones

## 5.1 Resumen de hallazgos clave
1. **Relación entre potencia y emisiones:** Se encontró una correlación negativa significativa entre la potencia del motor y las emisiones de CO2. Esto sugiere que a medida que aumenta la potencia, las emisiones de CO2 tienden a disminuir, lo que podría indicar que los vehículos más potentes están utilizando tecnologías más eficientes.
  
2. **Efecto del consumo:** Las emisiones de CO2 también mostraron una relación con el consumo de combustible, donde un menor consumo está asociado con menores emisiones. Esto destaca la importancia de la eficiencia energética en la reducción de emisiones contaminantes.

3. **Zonas de estandarización:** Al estandarizar las variables, se facilitó la comparación entre diferentes métricas. Las distribuciones estandarizadas indicaron que hay una variedad de desempeño entre los vehículos en términos de emisiones y consumo.

4. **Matriz de correlación:** La matriz de correlación reveló que la mayoría de las variables están interrelacionadas, lo que implica que un cambio en una variable podría afectar a las demás.

## 5.2 Recomendaciones
- **Fomentar la investigación en tecnología eficiente:** Se recomienda que los fabricantes de automóviles inviertan más en investigación y desarrollo de tecnologías que mejoren la eficiencia del combustible y reduzcan las emisiones de CO2.

- **Políticas ambientales:** Los responsables de las políticas deberían considerar la implementación de incentivos para vehículos que cumplan con estándares de baja emisión, así como promover el uso de energías limpias.

- **Educación del consumidor:** Los consumidores deben ser educados sobre la importancia de elegir vehículos con menor consumo de combustible y emisiones de CO2, para contribuir a un medio ambiente más saludable.

