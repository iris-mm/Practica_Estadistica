---
title: "Práctica 1: Estadística descriptiva"
date: "Estadística - Curso 2024/2025"

output: 
  html_document:
    toc: yes
    toc_float: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      warning = FALSE,
                      message = FALSE)
```

# **1. Introducción y definición de objetos**

## 1.1 Objetivo de la investigación

El objetivo de esta investigación es determinar la forma en que algunas características de distintos vehículos como son su tamaño, peso o potencia de motor; influyen en las emisiones que liberan al medioambiente.\
Para ello nos basamos en datos recogidos en España a lo largo de 2022.

## 1.2. Variables excluidas
Antes de comenzar el análisis, se han descartado 6 de las 26 variables que ofrece el dataset, ya que no se consideran relevantes para el estudio o contienen una muestra de datos demasiado pequeña. Las variables excluidas son las siguientes:

- **ID**: Es un identificador que no aporta valor al análisis de emisiones.
- **Total seating**: Se cubre mediante otras variables que ya proporcionan suficiente información acerca de las dimensiones del vehículo.
- **CO2/km emissions in WLTP** y **Consumption l/100km in WLTP**: Estas variables han sido descartadas ya que el dataset ofrece otras similares que resultan más útiles para el estudio (como el consumo máximo y mínimo de combustible y las emisiones de CO2).
- **Type hybrid**: Esta variable ha sido excluida debido a la falta de suficientes datos para que sea relevante en el análisis.


## 1.3. Nueva variable: Área frontal

Una variable nueva, "Área frontal", ha sido creada a partir de las dimensiones del ancho y la altura del vehículo. Esta variable tiene como propósito analizar cómo el tamaño del vehículo influye en su resistencia aerodinámica y, por ende, en el consumo de combustible y las emisiones de CO2. Cuanto mayor sea el área frontal de un vehículo, mayor será la resistencia al viento que experimenta, lo que, a su vez, eleva el consumo de energía y las emisiones de CO2. Esta variable será clave para estudiar la relación entre las dimensiones del vehículo y sus emisiones.

```  //{r}
emisiones <- emisiones %>%
  mutate(area_frontal_m2 = (width_mm / 1000) * (height_mm / 1000))
```

# **2. Diccionario de los datos**
```{r}
library(tidyverse)
library(summarytools)
library(ggplot2)
library(readxl)
library(dplyr)
library(knitr)
library(reshape2)
library(corrplot)
emisiones <- readxl::read_excel("idae_emissions.xlsx")
```

## 2.1. Clasificación de las variables

En esta sección se describen y clasifican las variables disponibles en el dataset, diferenciando entre variables cuantitativas y cualitativas, y explicando cómo se usarán en el análisis.

### 2.1.1. Variables cuantitativas

Las **variables cuantitativas** son aquellas que expresan cantidades numéricas y se dividen en dos subcategorías: **cuantitativas continuas** y **cuantitativas discretas**. Estas variables serán fundamentales en el análisis descriptivo y bivariante, así como para los estudios de correlación, regresión y covarianza.

- **Variables cuantitativas continuas**: Son aquellas que pueden tomar cualquier valor dentro de un rango continuo:

  - `Max Consumption l/100km`: Consumo máximo de combustible en litros por cada 100 km. Esta variable es clave para evaluar la eficiencia de combustible de los vehículos y su impacto en las emisiones.
  - `Max emissions gCO2/km`: Emisiones máximas de CO2 en gramos por kilómetro. Es una de las variables dependientes más importantes en el estudio.
  - `Min consumption l/100km`: Consumo mínimo de combustible, lo que permite ver la eficiencia mínima de un vehículo.
  - `Min emissions gCO2/km`: Emisiones mínimas de CO2.
  - `Width in mm`: Ancho del vehículo. Esta variable forma parte del cálculo del área frontal.
  - `Height in mm`: Altura del vehículo. Como el ancho, esta variable es fundamental para calcular la nueva variable de "área frontal".
  - `Gross vehicle weight in kg`: Peso bruto del vehículo. Esto es importante para estudiar cómo el peso influye en el consumo y las emisiones.
  - `Electric consumption kwh/100km`: Consumo de energía eléctrica por cada 100 km, relevante para analizar la eficiencia energética en los vehículos eléctricos.
  - `Power CV`: Potencia del vehículo medida en caballos de fuerza, que nos ayuda a entender la relación entre la potencia y las emisiones.
  - `Power electric kw`: Potencia del motor eléctrico en kilovatios, para vehículos eléctricos o híbridos.
  - `Battery capacity kwh`: Capacidad de la batería en kilovatios-hora.
  - `Area frontal (calculada)`: Producto del ancho y altura del vehículo, usada para explorar la influencia de las dimensiones en la resistencia aerodinámica y las emisiones.
  
- **Variables cuantitativas discretas**: Estas son variables numéricas que toman un número finito de valores, normalmente enteros.
  - `Engine displacement cm3`: Cilindrada del motor en centímetros cúbicos. La cilindrada suele estar relacionada con la potencia del motor y, por ende, con las emisiones.
  - `Power ice kw`: Potencia del motor de combustión interna en kilovatios.
  - `Battery range km`: Autonomía de la batería en kilómetros. Importante para estudiar la eficiencia en vehículos eléctricos.

### 2.1.2. Variables cualitativas

Las **variables cualitativas** se refieren a categorías o clases y se dividen en **categóricas nominales** y **categóricas ordinales**. Estas se utilizarán principalmente en análisis univariantes (frecuencias, gráficos de barras) y bivariantes (tablas de contingencia, análisis comparativos).

- **Variables cualitativas nominales**: Estas variables son categóricas pero no tienen un orden inherente entre sus categorías.

  - `Model`: Modelo del vehículo. Aunque categórica, es interesante evaluar si ciertos modelos están asociados con mayores o menores emisiones.
  - `Engine type`: Tipo de motor (eléctrico, híbrido, de combustión interna). Fundamental para hacer comparativas entre los diferentes tipos de motor y sus emisiones.
  - `Market segment`: Segmento de mercado al que pertenece el vehículo (urbano, compacto, SUV, etc.). Este tipo de información permitirá comparaciones entre diferentes tipos de vehículos.
  - `Fuel economy index`: Índice de eficiencia energética, que categoriza a los vehículos en diferentes niveles (A, B, C, etc.).

- **Variables cualitativas ordinales**: Estas variables tienen un orden lógico entre sus categorías:

  - `Transmission`: Tipo de transmisión (Manual, Semiautomática, Automática). Aquí se podría analizar si la transmisión tiene un impacto en el consumo o las emisiones.

## 2.2. Justificación del uso de las variables en el análisis

Cada una de las variables cuantitativas y cualitativas se utilizará para estudiar su impacto directo o indirecto en las emisiones de CO2. Algunas de las relaciones a explorar incluyen:

- **Consumo y emisiones**: El consumo máximo y mínimo de combustible (`Max Consumption l/100km` y `Min consumption l/100km`) se relacionarán con las emisiones máximas y mínimas de CO2 (`Max emissions gCO2/km` y `Min emissions gCO2/km`). Esta relación es crucial para comprobar si los vehículos que consumen más combustible también emiten más CO2.

- **Peso y emisiones**: La variable `Gross vehicle weight in kg` (peso del vehículo) será explorada en relación con las emisiones de CO2, ya que vehículos más pesados tienden a consumir más combustible y, por lo tanto, emitir más CO2.

- **Potencia y emisiones**: Las variables `Power CV` (potencia en caballos de fuerza) y `Power electric kw` (potencia del motor eléctrico) se utilizarán para estudiar si la potencia de los vehículos está correlacionada con sus emisiones. Vehículos más potentes podrían tener mayores emisiones debido a un mayor consumo de combustible.

- **Área frontal y emisiones**: La variable calculada `Área frontal` se utilizará para estudiar si los vehículos más grandes (con mayor área frontal) tienen mayores emisiones debido a la mayor resistencia aerodinámica.

- **Segmento de mercado y emisiones**: La variable `Market segment` se empleará para hacer comparaciones entre diferentes tipos de vehículos (SUV, compactos, urbanos, etc.) y ver si ciertos segmentos tienen más emisiones de CO2 que otros.

# **3. Análisis exploratorio de datos**

## 3.1. Análisis univariado

En esta parte se examina cada variable de forma individual para describir su comportamiento. Este análisis incluye gráficos y resúmenes numéricos.

### 3.1.1. Tablas de frecuencias

Se generarán tablas de frecuencias para variables cualitativas como **Engine type**, **Market segment**, y **Transmission**, para observar cómo se distribuyen estas categorías en el dataset.

####Frecuencia de tipos de motor

```{r}
frecuencia_tipo_motor <- emisiones %>%
  count(`Engine type`) %>%
  arrange(desc(n))

print(frecuencia_tipo_motor)
```

####Frecuencia de segmentos de mercado

```{r}
frecuencia_segmento_mercado <- emisiones %>%
  count(`Market segment`) %>%
  arrange(desc(n))

print(frecuencia_segmento_mercado)
```

####Frecuencia de tipo de transmisión

```{r}
frecuencia_transmision <- emisiones %>%
  count(`Transmission`) %>%
  arrange(desc(n))

print(frecuencia_transmision)
```

### 3.1.2. Gráficos de barras e histogramas


### 3.1.3. Resúmenes numéricos
--------Cálculo de media y mediana de emisiones--------
```{r}
mean_emissions <- mean(emisiones$`emissions_max_gCO2_km`, na.rm = TRUE)
median_emissions <- median(emisiones$`emissions_max_gCO2_km`, na.rm = TRUE)

mean_emissions
median_emissions
```
### 3.1.4. Gráfico de cajas (Boxplot)

-------- Resumen estadístico de variables relevantes -------- 
```{r}
resumen <- emisiones %>%
  summarise(
    Max_Consumption_mean = mean(`consumption_max_l_100km`, na.rm = TRUE),
    Max_Consumption_sd = sd(`consumption_max_l_100km`, na.rm = TRUE),
    Max_Emissions_mean = mean(`emissions_max_gCO2_km`, na.rm = TRUE),
    Max_Emissions_sd = sd(`emissions_max_gCO2_km`, na.rm = TRUE),
    Power_mean = mean(`power_ice_kw`, na.rm = TRUE),
    Power_sd = sd(`power_ice_kw`, na.rm = TRUE),
    Weight_mean = mean(`gross_vehicle_weight_rating_kg`, na.rm = TRUE),
    Weight_sd = sd(`gross_vehicle_weight_rating_kg`, na.rm = TRUE)
  )

resumen
```


## 3.2. Análisis bivariante

### 3.2.1. Tablas de contingencia
--------Gráfico de la distribución del Índice de Eficiencia del Combustible--------
```{r}
ggplot(emisiones, aes(x = `fuel_economy_index`)) +
  geom_bar(fill = "purple", color = "black") +
  labs(title = "Distribución del Índice de Eficiencia del Combustible",
       x = "Índice de Eficiencia",
       y = "Frecuencia") +
  theme_minimal()
```

### 3.2.2. Gráfico de dispersión
-------Tabla de frecuencias para "Fuel economy index"-------
```{r}
tabla_frecuencias_fuel_economy <- table(emisiones$`fuel_economy_index`)
print(tabla_frecuencias_fuel_economy)
```

### 3.2.3. Correlación y covarianza

- **Correlación de Pearson**: Se calcularán coeficientes de correlación entre variables como `Power CV` y `Max emissions gCO2/km`, para ver si existe una relación lineal fuerte entre la potencia del motor y las emisiones.

- **Covarianza**: La covarianza entre variables cuantitativas como `Max Consumption l/100km` y `Max emissions gCO2/km` mostrará cómo varían juntas estas variables. Una covarianza positiva indicaría que, a medida que aumenta el consumo de combustible, también aumentan las emisiones de CO2.

-------Tabla de frecuencias para "Engine type"-------
```{r}
tabla_frecuencias_engine_type <- table(emisiones$`engine_type`)
print(tabla_frecuencias_engine_type)
```


### 3.2.4. Gráfica de dispersión y regresión lineal
-------Visualización de las tablas de frecuencias-------

-------Gráfico de barras para el índice de eficiencia de combustible-------
```{r}
ggplot(as.data.frame(tabla_frecuencias_fuel_economy), aes(x = Var1, y = Freq)) +
  geom_bar(stat = "identity", fill = "lightblue") +
  labs(title = "Frecuencia del Índice de Eficiencia de Combustible",
       x = "Índice de Eficiencia",
       y = "Frecuencia") +
  theme_minimal()
```

-------Gráfico de barras para el tipo de motor-------
```{r}
ggplot(as.data.frame(tabla_frecuencias_engine_type), aes(x = Var1, y = Freq)) +
  geom_bar(stat = "identity", fill = "orange") +
  labs(title = "Frecuencia del Tipo de Motor",
       x = "Tipo de Motor",
       y = "Frecuencia") +
  theme_minimal()
```


-------Gráficos de dispersión-------
```{r}
ggplot(emisiones, aes(x = `power_ice_kw`, y = `emissions_max_gCO2_km`)) +
  geom_point(color = "red", size = 2) +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  labs(title = "Relación entre Potencia del motor y Emisiones de CO2",
       x = "Potencia del Motor (kw)",
       y = "Max emissions gCO2/km") +
  theme_minimal()
```

-------Potencia (kw) vs Máximas emisiones de CO2-------
```{r}
cor_power_emissions <- cor(emisiones$`power_ice_kw`, emisiones$`emissions_max_gCO2_km`, use = "complete.obs")
cor_power_emissions

```

-------Modelo de regresión lineal-------
```{r}
modelo <- lm(`emissions_max_gCO2_km` ~ `power_ice_kw`, data = emisiones)
summary(modelo)
```





-------Peso del vehículo vs Máximas emisiones de CO2-------
```{r}
ggplot(emisiones, aes(x = `gross_vehicle_weight_rating_kg`, y = `emissions_max_gCO2_km`)) +
  geom_point(color = "purple", size = 2) +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  labs(title = "Relación entre Peso del Vehículo y Emisiones de CO2",
       x = "Peso del Vehículo (kg)",
       y = "Max emissions gCO2/km") +
  theme_minimal()
```


-------Cilindrada del motor vs Máximas emisiones de CO2-------
```{r}
ggplot(emisiones, aes(x = `engine_displacement_cm3`, y = `emissions_max_gCO2_km`)) +
  geom_point(color = "cyan", size = 2) +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  labs(title = "Relación entre Cilindrada del Motor y Emisiones de CO2",
       x = "Cilindrada del Motor (cm3)",
       y = "Max emissions gCO2/km") +
  theme_minimal()

```

-------Gráficos de boxplot-------
-------Emisiones según el índice de eficiencia de combustible-------
```{r}
ggplot(emisiones, aes(x = `fuel_economy_index`, y = `emissions_max_gCO2_km`, fill = `fuel_economy_index`)) +
  geom_boxplot() +
  labs(title = "Emisiones de CO2 por Índice de Eficiencia de Combustible",
       x = "Índice de Eficiencia",
       y = "Max emissions gCO2/km") +
  theme_minimal()
```

-------Emisiones según el tipo de motor-------
```{r}
ggplot(emisiones, aes(x = `engine_type`, y = `emissions_max_gCO2_km`, fill = `engine_type`)) +
  geom_boxplot() +
  labs(title = "Emisiones de CO2 por Tipo de Motor",
       x = "Tipo de Motor",
       y = "Max emissions gCO2/km") +
  theme_minimal()
```


-------Correlación entre potencia y emisiones-------
cor_power_emissions <- cor(emisiones$`power_ice_kw`, emisiones$`emissions_max_gCO2_km`, use = "complete.obs")
cor_power_emissions


-------Modelo de regresión lineal-------

```{r}
modelo <- lm(`emissions_max_gCO2_km` ~ `power_ice_kw`, data = emisiones)
summary(modelo)
```

# **4. Tabla comparativa**

# **5. Conclusiones**

## 5.1 Resumen de hallazgos clave
1. **Relación entre potencia y emisiones:** Se encontró una correlación negativa significativa entre la potencia del motor y las emisiones de CO2. Esto sugiere que a medida que aumenta la potencia, las emisiones de CO2 tienden a disminuir, lo que podría indicar que los vehículos más potentes están utilizando tecnologías más eficientes.
  
2. **Efecto del consumo:** Las emisiones de CO2 también mostraron una relación con el consumo de combustible, donde un menor consumo está asociado con menores emisiones. Esto destaca la importancia de la eficiencia energética en la reducción de emisiones contaminantes.

3. **Zonas de estandarización:** Al estandarizar las variables, se facilitó la comparación entre diferentes métricas. Las distribuciones estandarizadas indicaron que hay una variedad de desempeño entre los vehículos en términos de emisiones y consumo.

4. **Matriz de correlación:** La matriz de correlación reveló que la mayoría de las variables están interrelacionadas, lo que implica que un cambio en una variable podría afectar a las demás.

## 5.2 Recomendaciones
- **Fomentar la investigación en tecnología eficiente:** Se recomienda que los fabricantes de automóviles inviertan más en investigación y desarrollo de tecnologías que mejoren la eficiencia del combustible y reduzcan las emisiones de CO2.

- **Políticas ambientales:** Los responsables de las políticas deberían considerar la implementación de incentivos para vehículos que cumplan con estándares de baja emisión, así como promover el uso de energías limpias.

- **Educación del consumidor:** Los consumidores deben ser educados sobre la importancia de elegir vehículos con menor consumo de combustible y emisiones de CO2, para contribuir a un medio ambiente más saludable.

