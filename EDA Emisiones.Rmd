---
title: "Práctica 1: Estadística descriptiva"
output: html_document
date: "Estadística - Curso 2024/2025"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      warning = FALSE,
                      message = FALSE)

COLOR_Frequency = "black"
COLOR_MaxEmissions = "lightblue"
COLOR_MaxConsumption = "blue"
COLOR_PowerIce = "green"
COLOR_FuelEconomyIndex = "pink"
COLOR_EngineType = "orange"
COLOR_FrontalArea = "purple"
COLOR_MaxConsumption100km = "darkblue"
```

## Introducción y definición de objetos

El objetivo de esta investigación es determinar la forma en que algunas características de distintos vehículos como son su tamaño, peso o potencia de motor; influyen en las emisiones que liberan al medioambiente.\
Para ello nos basamos en datos recogidos en España a lo largo de 2022.\
Previo al estudio, es necesario destacar que de entre las 26 variables que ofrece el dataset elegido, hemos descartado 6; dado que o bien no consideramos que sean completamente relevantes para la investigación o la muestra de datos es demasiado pequeña como para que tengan peso de referencia.\
Se prescinde de las variables "ID" y "Total seating" puesto que no se consideran relevantes para el estudio de las emisiones. Siendo la primera un identificador y la segunda un dato que va a ser cubierto por otras variables que proporcionan información acerca de las dimensiones de los vehículos.\
No se tendrán en cuenta tampoco las variables "CO2/km emissions in WLTP" y "Consumption l/100km in WLTP", ya que el dataset ofrece otras variables similares que creemos son más útiles en el estudio (Max & min Consumption l/100km, Max & min emissions gCO2/km). Así como la variable "Type hybrid", pues hay muy pocos datos recogidos como para que sea relevante.\
Finalmente, se ha decidido crear la variable adicional "frontal area" en reemplazo de las variables "length", "width" y "height" (siendo la primera descartada), con objeto de centralizar el estudio en datos que se refieran directamente a la contaminación de los vehículos.


## Importación de datos y carga de paquetes
```{r}
library(tidyverse)
library(summarytools)
library(ggplot2)
library(readxl)
library(dplyr)
library(knitr)
library(reshape2)
library(corrplot)
emisiones <- readxl::read_excel("idae_emissions.xlsx")
```

## Diccionario de Datos
- `ID`: Identificador del coche (identificador)
- `Model`: Modelo del coche (categórica multinivel)
- `Engine type`: Tipo de motor (categórica multinivel)
- `Max Consumption l/100km`: Máxima consumición de combustible en l cada 100km (numérica continua)
- `Max emissions gCO2/km`: Máxima consumición de combustible en l cada 100km (numérica continua)
- `Engine displacement cm3`: Cilindrada del motor en cm3 (numérica discreta)
- `Power ice kw`: Potencia del motor en combustión interna en kw (numérica discreta)
- `Battery range km`: Autonomía de la batería en km (numérica discreta)
- `CO2/km emissions in WLTP`: Emisiones de CO2 según el ciclo de prueba WLTP en g/km (numérica continua)
- `Width in mm`: Ancho del vehículo en mm (numérica continua)
- `Gross vehicle weight in kg`: M.m.a del vehículo en kg (numérica continua)
- `Fuel economy index`: Índice de eficiencia del vehículo (categórica multinivel; A,B,C,D,E,F,G,N/A)
- `Electric consumption kwh/100km`: Consumo de energía eléctrica cada 100km en kwh (numérica continua)
- `Market segment`: Tipo de vehículo (categórica multinivel)
- `Min consumption l/100km`: Mínima consumición de combustible en l cada 100km (numérica continua)
- `Min emissions gCO2/km`: Emisiones mínimas de CO2 en g/km (numérica continua)
- `Transmission`: Nivel de transmisión del vehículo (categórica ordinal; Manual-M, Semiautomática-SC, Automática-A)
- `Power CV`: Potencia del motor en CV (numérica continua)
- `Power electric kw`: Potencia del motor eléctrico en kw (numérica continua)
- `Consumption l/100km in WLTP`: Consumo de combustible según el ciclo de prueba WLTP en g/km (numérica continua)
- `Length in mm`: Largo del vehículo en mm (numérica continua)
- `Height in mm`: Altura del vehículo en mm (numérica continua)
- `Total seating`: Número de asientos del vehículo (numérica discreta)
- `Type hybrid`: Tipo de híbrido (categórica dicotómica; Enchufable/Convencional)
- `Battery capacity kwh`: Capacidad de la batería en kwh (númerica continua)

### Variable Frontal area

```{r}
emisiones <- emisiones %>%
  mutate(area_frontal_m2 = (width_mm / 1000) * (height_mm / 1000))

```
La variable frontal area nos proporciona información sobre la aerodinámica de los vehículos. Los que tengan una mayor área frontal ejercerán más resistencia contra el viento, haciendo que necesiten más energía para moverse y por tanto quemen más combustible.

## Análisis exploratorio de datos

### Datos univariantes

# Gráfico de la distribución de Max emissions gCO2/km

```{r}
ggplot(emisiones, aes(x = `emissions_max_gCO2_km`)) +
  geom_histogram(binwidth = 10, fill = COLOR_MaxEmissions, color = COLOR_Frequency) +
  labs(title = "Distribución de Máximas Emisiones de CO2 (g/km)",
       x = "Max emissions gCO2/km",
       y = "Frecuencia") +
  theme_minimal()
```

# Tipificación (Estandarización) de las variables numéricas
```{r}
emisiones_tipificadas <- emisiones %>%
  mutate(
    Max_emissions_z = scale(`emissions_max_gCO2_km`),
    Max_Consumption_z = scale(`consumption_max_l_100km`),
    Power_ice_z = scale(`power_ice_kw`),
    Gross_vehicle_weight_z = scale(`gross_vehicle_weight_rating_kg`),
    Battery_range_z = scale(`battery_range_km`),
    area_frontal_z = scale(area_frontal_m2)
  )
```

# Visualización de las variables tipificadas

# Histograma de la variable estandarizada "Max emissions"
```{r}
ggplot(emisiones_tipificadas, aes(x = Max_emissions_z)) +
  geom_histogram(binwidth = 0.5, fill = COLOR_MaxEmissions, color = COLOR_Frequency) +
  labs(title = "Distribución de Máximas Emisiones de CO2 (Estandarizada)",
       x = "Max emissions (Z-score)",
       y = "Frecuencia") +
  theme_minimal()
```

# Histograma de la variable estandarizada "Max Consumption"
```{r}
ggplot(emisiones_tipificadas, aes(x = Max_Consumption_z)) +
  geom_histogram(binwidth = 0.5, fill = COLOR_MaxConsumption, color = COLOR_Frequency) +
  labs(title = "Distribución de Consumo Máximo de Combustible (Estandarizada)",
       x = "Max Consumption (Z-score)",
       y = "Frecuencia") +
  theme_minimal()
```

# Histograma de la variable estandarizada "Power ice kw"
```{r}
ggplot(emisiones_tipificadas, aes(x = Power_ice_z)) +
  geom_histogram(binwidth = 0.5, fill = COLOR_PowerIce, color = COLOR_Frequency) +
  labs(title = "Distribución de Potencia del Motor (Estandarizada)",
       x = "Power ice kw (Z-score)",
       y = "Frecuencia") +
  theme_minimal()
```

# Calcular media y mediana de Max emissions gCO2/km
```{r}
mean_emissions <- mean(emisiones$`emissions_max_gCO2_km`, na.rm = TRUE)
median_emissions <- median(emisiones$`emissions_max_gCO2_km`, na.rm = TRUE)

mean_emissions
median_emissions
```


# Resumen estadístico de variables relevantes
```{r}
resumen <- emisiones %>%
  summarise(
    Max_Consumption_mean = mean(`consumption_max_l_100km`, na.rm = TRUE),
    Max_Consumption_sd = sd(`consumption_max_l_100km`, na.rm = TRUE),
    Max_Emissions_mean = mean(`emissions_max_gCO2_km`, na.rm = TRUE),
    Max_Emissions_sd = sd(`emissions_max_gCO2_km`, na.rm = TRUE),
    Power_mean = mean(`power_ice_kw`, na.rm = TRUE),
    Power_sd = sd(`power_ice_kw`, na.rm = TRUE),
    Weight_mean = mean(`gross_vehicle_weight_rating_kg`, na.rm = TRUE),
    Weight_sd = sd(`gross_vehicle_weight_rating_kg`, na.rm = TRUE)
  )

resumen
```

# Gráfico de la distribución del Índice de Eficiencia del Combustible
```{r}
ggplot(emisiones, aes(x = `fuel_economy_index`)) +
  geom_bar(fill = COLOR_FuelEconomyIndex, color = COLOR_Frequency) +
  labs(title = "Distribución del Índice de Eficiencia del Combustible",
       x = "Índice de Eficiencia",
       y = "Frecuencia") +
  theme_minimal()
```

### Datos bivariantes

# Tabla de frecuencias para la variable "Fuel economy index"
```{r}
tabla_frecuencias_fuel_economy <- table(emisiones$`fuel_economy_index`)
print(tabla_frecuencias_fuel_economy)
```

# Tabla de frecuencias para la variable "Engine type"
```{r}
tabla_frecuencias_engine_type <- table(emisiones$`engine_type`)
print(tabla_frecuencias_engine_type)
```


# Visualización de las tablas de frecuencias mediante gráficos de barras

# Gráfico de barras para el índice de eficiencia de combustible
```{r}
ggplot(as.data.frame(tabla_frecuencias_fuel_economy), aes(x = Var1, y = Freq)) +
  geom_bar(stat = "identity", fill = COLOR_FuelEconomyIndex) +
  labs(title = "Frecuencia del Índice de Eficiencia de Combustible",
       x = "Índice de Eficiencia",
       y = "Frecuencia") +
  theme_minimal()
```

# Gráfico de barras para el tipo de motor
```{r}
ggplot(as.data.frame(tabla_frecuencias_engine_type), aes(x = Var1, y = Freq)) +
  geom_bar(stat = "identity", fill = COLOR_EngineType) +
  labs(title = "Frecuencia del Tipo de Motor",
       x = "Tipo de Motor",
       y = "Frecuencia") +
  theme_minimal()
```


# Gráfico de dispersión: Potencia (kw) vs Max Emisiones CO2
```{r}
ggplot(emisiones, aes(x = `power_ice_kw`, y = `emissions_max_gCO2_km`)) +
  geom_point(color = COLOR_PowerIce, size = 2) +
  geom_smooth(method = "lm", se = FALSE, color = COLOR_MaxEmissions) +
  labs(title = "Relación entre Potencia del motor y Emisiones de CO2",
       x = "Potencia del Motor (kw)",
       y = "Max emissions gCO2/km") +
  theme_minimal()
```

# Correlación entre potencia del motor y emisiones
```{r}
cor_power_emissions <- cor(emisiones$`power_ice_kw`, emisiones$`emissions_max_gCO2_km`, use = "complete.obs")
cor_power_emissions

```

# Modelo de regresión lineal
```{r}
modelo <- lm(`emissions_max_gCO2_km` ~ `power_ice_kw`, data = emisiones)
summary(modelo)
```


# Gráfico de dispersión: Área frontal vs Max Consumption
```{r}
ggplot(emisiones, aes(x = area_frontal_m2, y = `consumption_max_l_100km`)) +
  geom_point(color = COLOR_FrontalArea, size = 2) +
  geom_smooth(method = "lm", se = FALSE, color = COLOR_MaxConsumption100km) +
  labs(title = "Relación entre Área Frontal y Consumo Máximo de Combustible",
       x = "Área Frontal (m2)",
       y = "Max Consumption l/100km") +
  theme_minimal()
```


###Gráfico de dispersión: Peso del vehículo vs. Máximas emisiones de CO2
```{r}
ggplot(emisiones, aes(x = `gross_vehicle_weight_rating_kg`, y = `emissions_max_gCO2_km`)) +
  geom_point(color = COLOR_MaxEmissions, size = 2) +
  geom_smooth(method = "lm", se = FALSE, color = COLOR_Frequency) +
  labs(title = "Relación entre Peso del Vehículo y Emisiones de CO2",
       x = "Peso del Vehículo (kg)",
       y = "Max emissions gCO2/km") +
  theme_minimal()
```


###Gráfico de dispersión: Cilindrada del motor vs. Máximas emisiones de CO2
```{r}
ggplot(emisiones, aes(x = `engine_displacement_cm3`, y = `emissions_max_gCO2_km`)) +
  geom_point(color = COLOR_MaxEmissions, size = 2) +
  geom_smooth(method = "lm", se = FALSE, color = COLOR_Frequency) +
  labs(title = "Relación entre Cilindrada del Motor y Emisiones de CO2",
       x = "Cilindrada del Motor (cm3)",
       y = "Max emissions gCO2/km") +
  theme_minimal()

```


# Gráfico de boxplot: Emisiones según el índice de eficiencia de combustible
```{r}
ggplot(emisiones, aes(x = `fuel_economy_index`, y = `emissions_max_gCO2_km`, fill = `fuel_economy_index`)) +
  geom_boxplot() +
  labs(title = "Emisiones de CO2 por Índice de Eficiencia de Combustible",
       x = "Índice de Eficiencia",
       y = "Max emissions gCO2/km") +
  theme_minimal()
```

# Gráfico de boxplot: Emisiones según el tipo de motor
```{r}
ggplot(emisiones, aes(x = `engine_type`, y = `emissions_max_gCO2_km`, fill = `engine_type`)) +
  geom_boxplot() +
  labs(title = "Emisiones de CO2 por Tipo de Motor",
       x = "Tipo de Motor",
       y = "Max emissions gCO2/km") +
  theme_minimal()
```


# Modelo de regresión lineal
```{r}
modelo <- lm(`emissions_max_gCO2_km` ~ `power_ice_kw`, data = emisiones)
summary(modelo)
```

## Conclusiones

### Resumen de hallazgos clave
1. **Relación entre potencia y emisiones:** Se encontró una correlación negativa significativa entre la potencia del motor y las emisiones de CO2. Esto sugiere que a medida que aumenta la potencia, las emisiones de CO2 tienden a disminuir, lo que podría indicar que los vehículos más potentes están utilizando tecnologías más eficientes.
  
2. **Efecto del consumo:** Las emisiones de CO2 también mostraron una relación con el consumo de combustible, donde un menor consumo está asociado con menores emisiones. Esto destaca la importancia de la eficiencia energética en la reducción de emisiones contaminantes.

3. **Zonas de estandarización:** Al estandarizar las variables, se facilitó la comparación entre diferentes métricas. Las distribuciones estandarizadas indicaron que hay una variedad de desempeño entre los vehículos en términos de emisiones y consumo.

4. **Matriz de correlación:** La matriz de correlación reveló que la mayoría de las variables están interrelacionadas, lo que implica que un cambio en una variable podría afectar a las demás.

### Recomendaciones
- **Fomentar la investigación en tecnología eficiente:** Se recomienda que los fabricantes de automóviles inviertan más en investigación y desarrollo de tecnologías que mejoren la eficiencia del combustible y reduzcan las emisiones de CO2.

- **Políticas ambientales:** Los responsables de las políticas deberían considerar la implementación de incentivos para vehículos que cumplan con estándares de baja emisión, así como promover el uso de energías limpias.

- **Educación del consumidor:** Los consumidores deben ser educados sobre la importancia de elegir vehículos con menor consumo de combustible y emisiones de CO2, para contribuir a un medio ambiente más saludable.

