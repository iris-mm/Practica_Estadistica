---
title: "Práctica 1: Estadística descriptiva"
date: "Estadística - Curso 2024/2025"

output: 
  html_document:
    toc: yes
    toc_float: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      warning = FALSE,
                      message = FALSE)

COLOR_Frequency = "black"
COLOR_MaxEmissions = "grey"
COLOR_EngineType = "orange"
COLOR_Consumption = "pink"
COLOR_EconomyIndex = "lightblue"
COLOR_PowerIce = "red"
COLOR_Weigth = "purple"
```

# **1. Introducción y definición de objetos **

## 1.1 Objetivo de la investigación

El objetivo de esta investigación es determinar la forma en que algunas características de distintos vehículos, como son su tamaño, peso o potencia de motor; influyen en las emisiones que liberan al medioambiente.\
Para el estudio nos basamos en datos recogidos en España a lo largo de 2022.

## 1.2. Variables excluidas
Antes de comenzar el análisis, se han descartado 11 de las 26 variables que ofrece el dataset, ya que no se consideran relevantes para el estudio o contienen una muestra de datos demasiado pequeña. Las variables excluidas y los motivos de esto son:

- **ID**: Identificador que no aporta valor al análisis de emisiones.
- **Total seating**: Se cubre mediante otras variables que ya proporcionan suficiente información acerca de las dimensiones del vehículo.
- **CO2/km emissions in WLTP** y **Consumption l/100km in WLTP**: Fueron descartadas ya que el dataset ofrece otras similares que resultan más útiles para el estudio (como el consumo máximo y mínimo de combustible y las emisiones de CO2).
- **Type hybrid**: Excluida debido a la falta de suficientes datos para que sea relevante en el análisis.
- **Make** y **Model**: Indica el fabricante del vehículo y su modelo, lo cual es irrelevante en el estudio de las emisiones.
- **Electric Consumption (kwh/100km), Power Electric (kw), Battery Capacity (kwh), Battery Range (km)**: Todos estos datos están relacionados con los coches eléctricos e híbridos, los cuales son poco relevantes en este contexto; si bien se nombran en varias partes del estudio pues no dejan de ser importantes por sus diferencias con los vehículos de combustibles fósiles.

## 1.3. Nueva variable: Área frontal

Una variable nueva, "Área frontal"; ha sido creada a partir de las dimensiones del ancho y la altura del vehículo. Esta variable tiene como propósito analizar cómo el tamaño del vehículo influye en su resistencia aerodinámica y por ende, en el consumo de combustible y las emisiones de CO2. Cuanto mayor sea el área frontal de un vehículo mayor será la resistencia al viento que experimenta, lo que a su vez eleva el consumo de energía y las emisiones de CO2.\
Se calculará la nueva variable al inicio del estudio univariante.

# **2. Carga de paquetes e Importación de datos **
```{r}
library(tidyverse)
library(summarytools)
library(ggplot2)
library(readxl)
library(dplyr)
library(knitr)
library(reshape2)
library(corrplot)
emisiones <- readxl::read_excel("idae_emissions.xlsx")
```

# **3. Diccionario de datos**

  **Variables cuantitativas continuas**\
  - `Max Consumption l/100km`: Consumo máximo de combustible en litros por cada 100 km.\
  - `Max emissions gCO2/km`: Emisiones máximas de CO2 en gramos por kilómetro. \
  - `Min consumption l/100km`: Consumo mínimo de combustible en litros por cada 100 km.\
  - `Min emissions gCO2/km`: Emisiones mínimas de CO2 en gramos por kilómetro.\
  - `Gross vehicle weight in kg`: Peso bruto del vehículo.\
  - `Power CV`: Potencia del vehículo medida en caballos de fuerza.\
  - `Width in mm`: Ancho del vehículo. Forma parte del cálculo del área frontal.\
  - `Height in mm`: Altura del vehículo. Forma parte del cálculo del área frontal.\
  - `Area frontal (calculada)`: Producto del ancho y altura del vehículo.\
  
  **Variables cuantitativas discretas**\
  - `Engine displacement cm3`: Cilindrada del motor en centímetros cúbicos.\
  - `Power ice kw`: Potencia del motor de combustión interna en kilovatios.\
  
  **Variables cualitativas multinivel**\
  - `Engine type`: Tipo de motor: gasolina, gasóleo, gas natural, híbridos de gasolina, híbridos enchufables, eléctricos puros.\
  - `Market segment`: Categoría en la que se clasifica el vehículo dentro del mercado, según su tamaño, uso o función (por ejemplo, bus, coche, SUV).\
  - `Fuel economy index`: Índice de eficiencia energética, que categoriza a los vehículos en diferentes niveles (A, B, C, D, E, F, G, N/A).\
  
  **Variables cualitativas ordinales**\
  - `Transmission`: Tipo de transmisión (Manual, Semiautomática, Automática).\

# **4. Análisis exploratorio de datos**

## 4.1. Análisis univariado

En esta parte se examina cada variable de forma individual para describir su comportamiento. Este análisis incluye gráficos y resúmenes numéricos.

### Cálculo de la variable Área frontal
```{r}
 emisiones <- emisiones %>%
  mutate(area_frontal_m2 = (width_mm / 1000) * (height_mm / 1000))
```

### 4.1.1. Tablas de frecuencias

Se crean tablas de frecuencias para las variables cualitativas **Engine type**, **Market segment**, y **Transmission**, con objeto de observar cómo se distribuyen estas categorías en el dataset.

**Frecuencia de tipos de motor**

La tabla muestra cuántos vehículos pertenecen a cada tipo de motor (gasolina, diésel, eléctrico, híbrido, etc.).\
Con ella podemos ver qué tecnología es la más común y consecuentemente su impacto en las emisiones. 

```{r}
frecuencia_tipo_motor <- emisiones %>%
  count(`engine_type`) %>%
  arrange(desc(n))

print(frecuencia_tipo_motor)
```

La tabla de frecuencia de tipos de motor muestra que los vehículos de gasolina y diésel son los más comunes, lo que sugiere que la mayoría de las emisiones provienen de estos tipos de motores. Existe también una presencia notable de eléctricos e híbridos, aunque su proporción es menor; lo cual indica que aunque se está avanzando hacia opciones más sostenibles los motores de combustión interna siguen dominando el mercado.\
Podemos concluir que hay una transición en progreso pero aún no se consolida hacia vehículos verdaderamente limpios.

**Frecuencia de segmentos de mercado**

La tabla refleja la cantidad de vehículos en diferentes categorías como compactos, SUV, sedanes y deportivos, entre otros.\
Con ella podemos identificar qué tipos de vehículos son más comunes y cómo se relacionan con las emisiones.

```{r}
frecuencia_segmento_mercado <- emisiones %>%
  count(`market_segment`) %>%
  arrange(desc(n))

print(frecuencia_segmento_mercado)
```

La tabla revela que los vehículos más comunes son las berlinas familiares de tamaño medio, seguidas de los vehículos pequeños, las furgonetas grandes y los SUV pequeños.\
Esto sugiere que, aunque hay una gran diversidad de tipos de vehículos; los segmentos de tamaño medio y pequeño dominan el mercado.\
Por otra parte, la presencia significativa de SUV y furgonetas grandes podría estar asociada con un mayor número de emisiones promedio, ya que estos vehículos suelen tener motores más grandes y consumen más combustible, lo que puede afectar a los niveles generales de emisiones.

**Frecuencia de tipo de transmisión**

La tabla muestra cuántos vehículos tienen transmisión manual, semiautomática o automática.\
Con esto podemos ver si existe una preferencia clara hacia ciertos tipos de transmisión, cosa que afecta directamente a las emisiones que producen los vehículos. 

```{r}
frecuencia_transmision <- emisiones %>%
  count(`transmission`) %>%
  arrange(desc(n))

print(frecuencia_transmision)
```

Se observa que la mayoría de los vehículos tienen transmisión automática, seguidos por los de transmisión manual.\
Esto indica una tendencia hacia las transmisiones automáticas, lo que podría deberse a que las versiones modernas suelen ser más eficientes en el consumo de combustible que las transmisiones manuales tradicionales. La baja presencia de transmisiones semiautomáticas refleja que este tipo es menos común en el mercado actual.\
La distribución también puede tener implicaciones en las emisiones, ya que las transmisiones más eficientes tienden a optimizar el rendimiento del motor y a reducir el consumo de combustible.

### 4.1.2. Gráficos de barras e histogramas

Utilizaremos Gráficos de barras e Histogramas para visualizar la distribución de las variables cualitativas de forma más directa.

**Gráfico de barras: Tipos de motor**

Se analiza la frecuencia de los distintos tipos de motores presentes en el dataset.\
Como mencionado anteriormente, los diferentes tipos de motores pueden tener un impacto significativo en las emisiones de CO2 y en la eficiencia del combustible.\
Al observar este gráfico se puede identificar qué tipo de motor es el más común entre los vehículos analizados.

```{r}
ggplot(emisiones, aes(x = `engine_type`)) +
  geom_bar(fill = COLOR_EngineType, color = COLOR_EngineType, alpha = 0.7) +
  labs(title = "Frecuencia de tipos de motor", x = "Tipo de motor", y = "Frecuencia") +
  theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) 
```

El gráfico muestra que los motores de gasóleo y gasolina son los más frecuentes, lo que indica una clara preferencia por vehículos de combustión tradicional.\
Aunque hay presencia de motores eléctricos e híbridos, su proporción es mucho menor; de lo que concluimos que aún queda un largo camino para que los vehículos más modernos encabecen el mercado.

**Gráfico de barras: Segmento de mercado**

Se evalúa la distribución de los vehículos según su categoría (por ejemplo motocicletas, SUVs, compactos, etc.). Este análisis es importante porque diferentes segmentos de mercado suelen tener diferentes características y por lo tanto, diferentes patrones de consumo y emisiones.\
Al observar la frecuencia de cada segmento, se pueden identificar cuáles son los más populares.

```{r}
ggplot(emisiones, aes(x = `market_segment`)) +
  geom_bar(fill = "blue", color = "blue", alpha = 0.6) +
  labs(title = "Frecuencia de segmentos de mercado", x = "Segmento de mercado", y = "Frecuencia") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 55, hjust = 1)) 
```

El gráfico muestra que el segmento de "Camión" predomina en el mercado, seguido por "Berlina-Familiar Medio" y "Furgón Grande".\
Con ello se señala una tendencia por vehículos de mayor tamaño, lo que generalmente se asocia a un mayor consumo de combustible y de emisiones de CO2.

**Gráfico de barras: Tipo de transmisión**

Se examina la distribución de los vehículos según su sistema de transmisión (manual, automática, semiautomática).\
La elección del tipo de transmisión puede influir en el rendimiento del vehículo y en su eficiencia. Al observar este gráfico, se puede determinar cuál es el tipo de transmisión más común y cómo esta podría relacionarse con las preferencias del consumidor y su impacto en las emisiones.

```{r}
ggplot(emisiones, aes(x = `transmission`)) +
  geom_bar(fill = "lightcoral", color = "lightcoral", alpha = 0.7) +
  labs(title = "Frecuencia de tipos de transmisión", x = "Transmisión", y = "Frecuencia") +
  theme_minimal()
```

El gráfico muestra que la mayoría de los vehículos tienen transmisión automática, lo que indica una clara preferencia del consumidor por la comodidad y facilidad de manejo que ofrece este tipo de transición frente a las demás.

**Histograma: Emisiones máximas de CO2 (gCO2/km)**

Se analiza la distribución de las emisiones en gramos de CO2 por kilómetro.\
Este análisis es fundamental porque permite identificar cómo se agrupan las emisiones de diferentes vehículos y cuáles son los niveles más comunes.\
Al observar este histograma, podemos detectar si hay una tendencia hacia vehículos con bajas o altas emisiones.

```{r}
ggplot(emisiones, aes(x = `emissions_max_gCO2_km`)) +
  geom_histogram(binwidth = 10, fill = COLOR_MaxEmissions, color =  COLOR_MaxEmissions, alpha = 0.7) +
  labs(title = "Distribución de Emisiones Máximas de CO2", x = "Emisiones Máximas (gCO2/km)", y = "Frecuencia") +
  theme_minimal()
```

La agrupación en el centro sugiere una mezcla de eficiencia y moderación en las emisiones que refleja la intención de los vehículos modernos en alcanzar niveles más bajos de contaminación.

**Histograma: Consumo máximo de combustible (l/100km)**

Se investiga cómo se distribuye el consumo de combustible en litros por cada 100 kilómetros recorridos.\
Al observar este histograma, se pueden identificar patrones de consumo que reflejan la tecnología de los motores y el diseño de los vehículos.

```{r}
ggplot(emisiones, aes(x = `consumption_max_l_100km`)) +
  geom_histogram(binwidth = 1, fill = COLOR_Consumption, color = COLOR_Consumption, alpha = 0.7) +
  labs(title = "Distribución del Consumo Máximo de Combustible", x = "Consumo Máximo (l/100km)", y = "Frecuencia") +
  theme_minimal()
```

La distribución del consumo máximo de combustible muestra que la mayoría de los vehículos analizados son eficientes, con un consumo bajo en general. Sin embargo, la presencia de un valor elevado en el extremo alto del histograma indica que existen vehículos menos eficientes que contribuyen exponencialmente a las emisiones de CO2.

**Histograma: Peso bruto del vehículo (kg)**

Se analiza la distribución del peso de los vehículos del dataset en kilogramos. Este análisis es importante porque el peso de un vehículo influye directamente en su rendimiento, eficiencia de combustible y emisiones de CO2.\
Al observar el histograma, podremos identificar si se tiende a fabricar vehículos más o menos pesados con carácter general.

```{r}
ggplot(emisiones, aes(x = `gross_vehicle_weight_rating_kg`)) +
  geom_histogram(binwidth = 100, fill = COLOR_Weigth, color = COLOR_Weigth, alpha = 0.7) +
  labs(title = "Distribución del Peso Bruto del Vehículo", x = "Peso Bruto (kg)", y = "Frecuencia") +
  theme_minimal()
```

La concentración de la mayoría de los vehículos en el lado izquierdo del histograma indica que el dataset está compuesto en gran parte por vehículos más ligeros. Ello apunta a la intención de crear modelos más eficientes en consumo de combustible y menores emisiones de CO2, lo cual es favorable desde una perspectiva ambiental.

**Histograma: Índice de eficiencia del motor**

Se analiza la distribución de la eficiencia del motor de los vehículos para conocer cuales son los valores más comunes y contrastarlos con su posible impacto en la contaminación por emisiones.

```{r}
ggplot(emisiones, aes(x = `fuel_economy_index`)) +
  geom_bar(fill = COLOR_EconomyIndex, color = COLOR_EconomyIndex, alpha = 0.7) +
  labs(title = "Distribución del Índice de Eficiencia del Combustible",
       x = "Índice de Eficiencia",
       y = "Frecuencia") +
  theme_minimal()
```

A pesar de que muchos de los vehículos no estén clasificados en el dataset, podemos ver una mayoría evidente en aquellos categorizados como C, D y B.\
De esto concluimos que muchos se encuentran en rangos medio altos de eficiencia de combustible, lo que una vez más señala el objetivo de los coches modernos por evitar sistemas que favorezcan la contaminación al medio.

### 4.1.3. Resúmenes numéricos
 
Vamos a proceder a calcular la media, mediana, mínimos, máximos, y primer y tercer cuantil de diferentes parámetros del dataset.

**Resumen datos de consumición mínima de litros por 100km**

```{r}
summary(emisiones$`consumption_max_l_100km`)
```

La mayor parte de los vehículos consumen entre 5.6 y 7.6 litros por cada 100 km, lo cual es un consumo bastante eficiente; sin embargo hay vehículos pueden consumir hasta 26.4 l/100 km, que es un valor alto y seguramente señale a coches muy grandes y/o potentes.\
El consumo mínimo de 0.4 l/100 km podría verse como una anomalía o referirse a vehículos híbridos o eléctricos.

**Resumen datos de emisión máxima de CO2 por kilómetro**

```{r}
summary(emisiones$`emissions_max_gCO2_km`)
```

El rango de emisiones es realmente amplio, con la mayoría de los vehículos encontrándose con una consumición de entre 133 y 183 g/km de CO2.\
La media y la mediana están muy cerca la una de la otra, por lo que podemos ver que la mayoría emiten CO2 de una forma moderada. Los valores máximos de hasta 394 g/km podrían deberse a la antigüedad del modelo o a vehículos poco eficientes. Por otro lado, el valor mínimo de 5.6 g/km es probablemente un vehículo eléctrico o híbrido con emisiones muy bajas.

**Resumen datos de consumición mínima de litros por 100km**

```{r}
summary(emisiones$`consumption_min_l_100km`)
```

Los valores de consumo se ven moderados, con la mayoría de los vehículos en un valor entre 5.2 y 6.9 l/100 km. La media es de 6.129 l/100 km, lo que sugiere que los vehículos tienden a ser algo eficientes si tienen un bajo consumo. El valor máximo de 60 l/100 km parece deberse a una anomalía que señala a un vehículo que en ciertas condiciones, tiene un consumo extremadamente alto.

**Resumen datos de emisión mínima de CO2 por kilómetro**

```{r}
summary(emisiones$`emissions_min_gCO2_km`)
```

A través de la mediana y los cuartiles vemos que la mayoría de los vehículos emiten entre 124 y 170 g/km de CO2 en condiciones mínimas, lo cual es un comportamiento normal. La media de 146.3 g/km quiere decir que las emisiones son bastante moderadas. Nuevamente, valores como 3.0 g/km se refieren a vehículos más limpios, mientras que los 374 g/km pertenecen a vehículos muy contaminantes.

**Resumen datos de peso de los vehículos en kilogramos**

```{r}
summary(emisiones$`gross_vehicle_weight_rating_kg`)
```

La mayoría de los vehículos tienen un peso entre 1,860 y 2,800 kg, con una media de 3,642 kg. Los valores máximos de hasta 70,000 kg reflejan que el conjunto de datos incluye vehículos extremadamente pesados (como camiones, autobuses articulados, etc). El valor mínimo de 0 kg probablemente se deba a una falta de información en el dataset.

**Resumen datos de potencia de los vehículos**

```{r}
summary(emisiones$`power_cv`)
```

La potencia de los vehículos está concentrada en un rango deducible y razonable, con la mayoría de los vehículos encontrándose entre 107.3 y 176.6 CV, y una media de 150.4 CV. Esto indica que la mayoría de los vehículos tienen una potencia suficiente para el uso diario de una persona promedio, lo cual es lógico dado a que gran parte de la población tiene al menos un vehículo. El valor máximo de 729.6 CV sugiere la presencia de vehículos concretos de alta potencia o de alto rendimiento. El valor mínimo de 0 CV, al igual que con la variable anterior, podría deberse a una falta de información en la base de datos.

### 4.1.4. Gráfico de cajas (Boxplot)

Utilizaremos los gráficos Boxplot para visualizar la distribución de los datos cuantitativos dentro de los quartiles, además de representar la mediana y encontrar valores atípicos.
  
  
**Boxplot para las emisiones máximas de CO2**

```{r}
ggplot(emisiones, aes(x = "", y = `emissions_max_gCO2_km`)) +
  geom_boxplot(fill = COLOR_MaxEmissions, outlier.colour = "black") +
  labs(title = "Boxplot de Emisiones Máximas de CO2", y = "Emisiones (gCO2/km)") +
  theme_minimal() +
  coord_flip()
```

- Rango Entre cuartiles (IQR): A través del rango entre el primer cuartil (Q1 ≈ 133 gCO2/km) y el tercer cuartil (Q3 ≈ 183 gCO2/km) podemos ver que la mayoría de los vehículos emiten entre 133 y 183 gramos de CO2 por kilómetro, lo que indica un nivel normal de emisiones.

- Mediana: La mediana se sitúa aproximadamente a 151 gCO2/km, lo que significa que la mitad de los vehículos emiten menos de este valor y la otra mitad emiten más.

- Anomalías: Los puntos fuera de la caja del gráfico pertenecen a vehículos más antiguos o menos eficientes.

La mayoría de los vehículos tienen emisiones moderadas, pero existen vehículos puntuales con emisiones extremadamente altas.

**Boxplot para el consumo máximo de combustible**

```{r}
ggplot(emisiones, aes(x = "", y = `consumption_max_l_100km`)) +
  geom_boxplot(fill = COLOR_Consumption, outlier.colour = "black") +
  labs(title = "Boxplot de Consumo Máximo de Combustible", y = "Consumo (l/100km)") +
  theme_minimal() +
  coord_flip()
```

- Rango entre cuartiles (IQR): La mayor parte de los vehículos consumen entre 5.6 l/100 km (Q1) y 7.6 l/100 km (Q3), lo que indica una eficiencia moderada en el consumo de combustible.

- Mediana: La mediana está alrededor de 6.3 l/100 km, lo que nos deja ver que el 50% de los vehículos consumen menos de esta cantidad y el 50% más.

- Anomalías: Se observan varios vehículos con consumos extremadamente altos (hasta 26.4 l/100 km), que corresponden a vehículos de alto rendimiento.

- Conclusión: La mayoría de los vehículos tiene un consumo de combustible moderado, pero existen outliers que consumen de manera muy alta.

**Boxplot para el peso bruto del vehículo**

```{r}
ggplot(emisiones, aes(x = "", y = `gross_vehicle_weight_rating_kg`)) +
  geom_boxplot(fill = COLOR_Weigth, outlier.colour = "black") +
  labs(title = "Boxplot de Peso Bruto del Vehículo", y = "Peso Bruto (kg)") +
  theme_minimal() +
  coord_flip()
```

- Rango entre cuartiles (IQR): La mayoría de los vehículos tienen un peso bruto entre 1,860 kg (Q1) y 2,800 kg (Q3), lo que corresponde a vehículos ligeros y medianos.

- Mediana: La mediana es de aproximadamente 2,120 kg, lo que indica que la mitad de los vehículos pesa menos y la otra mitad más.

- Anomalías: Podemos ver la gran cantidad de puntos que se encuentran en el gráfico y lo lejos que están del rango entre cuartiles. Esto se debe a que estos vehículos se consideran pesados (y seguramente no sean de uso común).

- Conclusión: La mayoría de los vehículos tienen pesos dentro de un rango normal, pero hay algunos vehículos extremadamente pesados que podrían corresponder a camiones o vehículos industriales.

## 4.2. Análisis bivariante

Ahora estudiaremos las relaciones entre dos variables a la vez para identificar patrones y dependencias.

**Las relaciones a explorar son las siguientes:**

- **Tipo de motor y Tipo de vehículo**: Se estudia la distribución entre los tipos de motor (diésel, gasolina, híbrido, etc.) con los distintos segmentos de mercado para determinar los motores que predominan y en qué vehículos.

- **Consumo y Emisiones de CO2**: El consumo máximo (`Max Consumption l/100km`) se relacionará con las emisiones máximas de CO2 (`Max emissions gCO2/km`). Con esta relación comprobaremos si los vehículos que consumen más combustible también emiten más CO2.

- **Área frontal y Emisiones de CO2**: Utilizamos la variable de área frontal calculada al principio del estudio para comprobar si los vehículos más grandes (con mayor área frontal) tienen mayores emisiones debido a la resistencia aerodinámica.

- **Área frontal y Consumo máximo**: Se analiza esta relación para determinar cómo el diseño aerodinámico de los vehículos afecta a su eficiencia y al consumo máximo de combustible.

- **Potencia y Emisiones de CO2**: Relacionamos la potencia en caballos de fuerza (`Power CV`) y las emisiones de CO2, para estudiar si vehículos más potentes podrían tener mayores emisiones debido a un mayor consumo de combustible.

- **Potencia del motor en CV y Emisiones de CO2**: Se investiga esta relación para ver si la potencia del motor en caballos influye en la cantidad de emisiones generadas, ya que vehículos más potentes podrían consumir más combustible.

- **Potencia del motor y Emisiones de CO2**: Se relacionan para evaluar si un aumento en la potencia del motor se traduce en un incremento en las emisiones de CO2, analizando las características de los vehículos.

- **Peso y Emisiones de CO2**: El peso del vehículo (`Gross vehicle weight in kg`) será explorada en relación con las emisiones de CO2, ya que se prevé que vehículos más pesados (que tienden a consumir más combustible) emitan más CO2.

- **Cilindrada del Motor y Emisiones de CO2**: Se estudia esta relación para verificar si motores de mayor cilindrada tienden a emitir más CO2, debido a su diseño y capacidad de combustión.

- **Emisiones de CO2 por Índice de Eficiencia de Combustible**: Se contempla esta relación para entender cómo la eficiencia del combustible se relaciona con las emisiones de CO2, ayudando a clasificar los vehículos según su impacto ambiental.

- **Emisiones de CO2 por Tipo de Motor**: Se relacionan para comprobar las diferencias en las emisiones de CO2 entre vehículos con diferentes tipos de motor (eléctrico, híbrido, gasolina, diésel...).

- **Tipos de vehículo vs Variables de rendimiento**: Empleamos la variable `Market segment` para hacer comparaciones entre diferentes tipos de vehículos (autobuses, motocicletas, urbanos, etc.) y ver si ciertos segmentos emiten más emisiones de CO2 o consumen más combustible que otros y como influye la cilindrada del motor en ello.

- **Transmisión vs Consumo y Emisiones de CO2**: Se analiza esta relación para observar cómo el tipo de transmisión (automática, manual, semiautomática) afecta el consumo de combustible y las emisiones generadas por los vehículos.

- **Cilindrada vs Consumo y Emisiones de CO2**: Se investiga esta relación para comprobar si existe una correlación directa entre el tamaño del motor (cilindrada) y el consumo de combustible y las emisiones de CO2, reflejando la eficiencia del vehículo.

### 4.2.1. Tablas de contingencia

Se ha creado una tabla de contingencia para explorar la relación entre las variables cualitativas `Engine type` y `Market segment`. Esto permitirá ver si ciertos tipos de motor están asociados a tipos específicos de vehículos, revelando lo que predomina en el mercado y cómo esto afecta a la cantidad de emisiones que se generan.

**Tabla de contingencia: Tipo de motor y Tipo de vehículo**

```{r}
tabla_contingencia <- table(emisiones$`engine_type`, emisiones$`market_segment`)
print(tabla_contingencia)
```

A continuación se ofrece un gráfico con la información anterior dispuesta de forma más clara.

```{r}
library(ggplot2)

ggplot(emisiones, aes(x = `market_segment`, fill = `engine_type`)) +
  geom_bar(position = "fill") + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(x = "Segmento de mercado", y = "Proporción", fill = "Tipo de motor") +
  ggtitle("Distribución de tipos de motor por segmento de mercado")
```

De esta tabla podemos sacar algunos puntos interesantes en nuestro estudio:

**Distribución de vehículos eléctricos:** Los vehículos eléctricos (mayormente los eléctricos puros) están presentes en muchos segmentos, como "Berlinas-Familiares", "Todoterrenos" y "Furgonetas". También se aprecia una fuerte representación en "Camiones" y "Cuadriciclos".

**Gasolina y Gasóleo:** Los motores de gasolina y gasóleo tienden a dominar segmentos que representan formas de vehículos más clásicos, como pueden ser las "Berlinas" y "Todoterrenos". Y están ausentes en aquellos reservados exclusivamente a los motores eléctricos, como son los grupos de "Motocicletas" y "Cuadriciclos".

**Híbridos:** De los grupos de híbridos predominan los "Híbridos enchufables" frente a los "Híbridos de gasóleo", apareciendo estos en varios segmentos como "Berlinas", "Todoterrenos" y "Deportivos".

### 4.2.2. Gráficos de dispersión

Se emplean gráficos de dispersión para explorar cómo se comportan unas variables cuantitativas respecto de otras.\
En este caso vamos a ver la relación entre el consumo de combustible (`Max Consumption l/100km`) y las emisiones de CO2 (`Max emissions gCO2/km`), y entre el área frontal (`Área frontal`) y nuevamente las emisiones de CO2.

**Dispersión: Consumo máximo y Emisiones máximas**

```{r}
library(ggplot2)
ggplot(emisiones, aes(x = `consumption_max_l_100km`, y = `emissions_max_gCO2_km`)) +
  geom_point(color = COLOR_MaxEmissions) +
  labs(title = "Dispersión entre Consumo Máximo y Emisiones Máximas",
       x = "Consumo Máximo (l/100km)",
       y = "Emisiones Máximas (gCO2/km)") +
  theme_minimal()
```

En este gráfico se confirma la tendencia de que, a mayor consumo, mayores son sus emisiones de CO2; aunque también se pueden observar varios valores atípicos que indican que algunos vehículos modernos como los vehículos híbridos de gasolina consumen cantidades considerables de combustible, pero contaminan mucho menos que la media.

**Dispersión: Área frontal y emisiones máximas**

```{r}
ggplot(emisiones, aes(x = `area_frontal_m2`, y = `emissions_max_gCO2_km`)) +
  geom_point(color = COLOR_MaxEmissions) +
  labs(title = "Dispersión entre Área Frontal y Emisiones Máximas",
       x = "Área Frontal (m²)",
       y = "Emisiones Máximas (gCO2/km)") +
  theme_minimal()
```

Por otra parte, aquí se puede ver como, en términos generales; a mayor área frontal, mayores emisiones de CO2 se generan. Sin embargo, algunos valores atípicos indican que hay grupos de vehículos pequeños que contaminan tanto como otros mucho más grandes; lo cual refleja que el tamaño puede no ser un factor tan determinante en el número de emisiones de un vehículo.

**Dispersión: Área frontal y consumo máximo**

```{r}
library(ggplot2)
ggplot(emisiones, aes(x = `area_frontal_m2`, y = `consumption_max_l_100km`)) +
  geom_point(color = COLOR_Consumption) +
  labs(title = "Dispersión entre el Area Frontal y el Consumo Máximo",
       x = "Area Frontal (m2)",
       y = "Consumo Máximo (gCO2/km)") +
  theme_minimal()
```

Aquí se descubre que el consumo del vehículo y su área frontal comparten datos muy similares a lo de la relación anterior, lo que puede confirmar a su vez una relación entre el consumo y las emisiones máximas del vehículo.

### 4.2.3. Correlación y covarianza

En esta parte analizaremos las relaciones entre pares de variables cuantitativas utilizando el cálculo de coeficientes de correlación y covarianza. Esto nos permitirá entender la fuerza y dirección de la relación entre las dos variables.

 **Correlaciones a realizar**
 
En este estudio, calcularemos la correlación de Pearson para estudiar las siguientes relaciones:

- Max Consumption l/100km y Max emissions gCO2/km: Con el objetivo de ver si el aumento en el consumo máximo de combustible está asociado con un aumento en las emisiones máximas de CO2.

- Power CV y Max emissions gCO2/km: Para determinar si los vehículos con mayor potencia en caballos de fuerza emiten más CO2.


**Correlación entre Max Consumption l/100km y Max emissions gCO2/km**

```{r}
cor(emisiones$consumption_max_l_100km, emisiones$emissions_max_gCO2_km, method = "pearson", use = "complete.obs")
```

La correlación de Pearson calculada devuelve un valor de 0.8216, lo que indica una relación lineal positiva fuerte entre estas dos variables. Esto significa que a medida que el consumo máximo de combustible de un vehículo aumenta, también lo hacen las emisiones máximas de CO2.


**Correlación entre Power CV y Max emissions gCO2/km**

```{r}
cor(emisiones$power_cv, emisiones$emissions_max_gCO2_km, method = "pearson", use = "complete.obs")
```

Entre estas variables el valor es de 0.3801, lo que indica una relación lineal positiva no muy fuerte entre estas dos variables. Esto significa que aunque existe una tendencia en los vehículos con mayor potencia en cv a emitir más CO2, la relación no es muy fuerte; pues existirán otros factores que influyen más significativamente en las emisiones de CO2 que la potencia del vehículo. 

 **Covarianzas a realizar**
 
Ahora calcularemos la covarianza para los mismos pares de variables para comprobar los resultados, es decir; entre Max Consumption l/100km y Max emissions gCO2/km para ver si un mayor consumo implica una mayor emisión de CO2 y entre Power CV y Max emissions gCO2/km para ver si los vehículos con mayor potencia en caballos de fuerza emiten más CO2.

**Covarianza entre Max Consumption l/100km y Max emissions gCO2/km**

```{r}
cov(emisiones$emissions_max_gCO2_km, emisiones$consumption_max_l_100km, use = "complete.obs")
```

Como este resultado es positivo, entonces existe una relación directa entre estas dos variables, lo que significa que a medida que el consumo de combustible aumenta, también tienden a aumentar las emisiones de CO2.

**Covarianza entre Power CV y Max emissions gCO2/km**

```{r}
cov(emisiones$power_cv, emisiones$emissions_max_gCO2_km, use = "complete.obs")
```

Al ser el resultado positivo, existe una relación directa entre estas dos variables, indicando que a medida que aumenta la potencia del motor, también tienden a aumentar las emisiones de CO2.

### 4.2.4. Regresiones lineales con gráficos de dispersión

En este apartado estudiaremos relaciones directas entre dos variables para confirmar teorías, encontrar patrones y más.

**Relación entre Potencia del motor y Emisiones de CO2**

```{r}
ggplot(emisiones, aes(x = `power_ice_kw`, y = `emissions_max_gCO2_km`)) +
  geom_point(color = COLOR_MaxEmissions, size = 2) +
  geom_smooth(method = "lm", se = FALSE, color = COLOR_PowerIce) +
  labs(title = "Relación entre Potencia del motor y Emisiones de CO2",
       x = "Potencia del Motor (kw)",
       y = "Max emissions gCO2/km") +
  theme_minimal()
```

Cada punto en la gráfica representa un vehículo, la posición X se relaciona con la potencia del motor de este vehículo, el cual, en caso de no estar explícitamente; se aproxima al valor más cercano encontrado en la gráfica, además se establece la posición Y marcando su emisión máxima y hallando la posición final del punto.\
Esta gráfica revela muchos datos importantes, siendo tres puntos cruciales que:

- Una minoría de los vehículos funcionan en su mayor medida en combustibles no fósiles, siendo estos los puntos más bajos de la gráfica. Esto muestra que, si un vehículo funciona mediante estos combustibles la potencia de su motor no afecta a las emisiones, lo cual se sabe gracias a que todos estos puntos tienden a mantenerse entre 20 y 80 g/km de emisiones, mientras que el nivel de la potencia del motor aumenta.\
- La mayoría de los vehículos se establecen en un rango concreto (100 y 300 g/km) de emisiones y entre los 50 y 200 kW de potencia del motor. Con ello concluimos que muchos de estos vehículos poseen características comunes que afectan a las emisiones.\
- A medida que la potencia del motor aumenta también lo hacen las emisiones, pero cabe destacar la posición de los puntos, ya que no muestran una amplitud lineal. Se ve como los puntos por debajo de la línea que representa la potencia aumentan con ella, y sin embargo los puntos por encima no la siguen, sino que tienen un rango propio. Parece que las emisiones máximas crecen hasta su punto más alto (400 g/km) y de ahí decrecen hasta llegar a la propia línea de la potencia, marcando su mínimo imaginario.

**Regresión lineal entre las Emisiones máximas y la Potencia del motor**

```{r}
modelo <- lm(`emissions_max_gCO2_km` ~ `power_ice_kw`, data = emisiones)
summary(modelo)
```

Existe una relación donde por cada 0.3 kW de energía se emiten un aproximado de 120 g/km de CO2.\
Con ello, se genera una relación de 0.145, lo cual implica que, la potencia del motor del vehículo no se relaciona directamente con las emisiones máximas.


**Relación entre Peso del Vehículo y Emisiones de CO2**

```{r}
ggplot(emisiones, aes(x = `gross_vehicle_weight_rating_kg`, y = `emissions_max_gCO2_km`)) +
  geom_point(color = COLOR_MaxEmissions, size = 2) +
  geom_smooth(method = "lm", se = FALSE, color = COLOR_Weigth) +
  labs(title = "Relación entre Peso del Vehículo y Emisiones de CO2",
       x = "Peso del Vehículo (kg)",
       y = "Emisiones Máximas (gCO2/km)") +
  theme_minimal()
```

De la gráfica podemos concluir que existe una relación positiva entre ambas variables y que por ende, cuanto más pesa un vehículo, más emisiones de CO2 tiende a liberar al medioambiente. No obstante, podemos observar numerosos puntos de la gráfica que no siguen estrictamente este patrón, es decir el gráfico es bastante disperso. Todo ello da a entender que existen múltiples factores agenos al peso que pueden contribuir de forma importante al número de emisiones que genera el vehículo, lo que explica cómo muestras con características similares pueden presentar datos completamente distintos.

**Relación entre Cilindrada del Motor y Emisiones de CO2**

```{r}
ggplot(emisiones, aes(x = `engine_displacement_cm3`, y = `emissions_max_gCO2_km`)) +
  geom_point(color = COLOR_MaxEmissions, size = 2) +
  geom_smooth(method = "lm", se = FALSE, color = "green") +
  labs(title = "Relación entre Cilindrada del Motor y Emisiones de CO2",
       x = "Cilindrada del Motor (cm3)",
       y = "Emisiones Máximas (gCO2/km)") +
  theme_minimal()

```

La gráfica refleja una relación positiva entre la cilindrada del motor y las emisiones máximas de CO2, lo que indica que, en general; los motores con mayor cilindrada tienden a emitir más CO2. Aunque la línea de tendencia confirma esta relación, se observa una dispersión significativa de los puntos a lo largo del gráfico, lo que sugiere que dentro de un mismo rango de cilindrada, las emisiones pueden variar considerablemente. Esto indica que, además de la cilindrada, otros factores también influyen en las emisiones de CO2; lo que explica las diferencias entre vehículos con motores de tamaño similar.

**Emisiones de CO2 por Índice de Eficiencia de Combustible**

```{r}
ggplot(emisiones, aes(x = `fuel_economy_index`, y = `emissions_max_gCO2_km`, fill = `fuel_economy_index`)) +
  geom_boxplot() +
  labs(title = "Emisiones de CO2 por Índice de Eficiencia de Combustible",
       x = "Índice de Eficiencia",
       y = "Emisiones Máximas (gCO2/km)") +
  theme_minimal()
```

Pese a que muchos vehículos no estén clasificados, se pueden extraer datos muy relevantes de cada uno de los grupos.\
- El rango de emisiones del grupo A es extremadamente alto, teniendo el RIC más grande.
- Los grupos B y C presentan los rangos de emisiones más pequeños. Esto podría deberse a que estos vehículos comparten características más uniformes dentro de sus categorías de eficiencia de combustible. Como hemos visto en gráficas anteriores, los vehículos de los grupos B, C, y D suelen tener motores más grandes, y esta homogeneidad en características como el tipo de motor y otras especificaciones técnicas puede explicar por qué las emisiones dentro de estos grupos varían menos. Es decir, la similitud entre los vehículos de estos grupos podría reducir la variabilidad en sus emisiones.


**Emisiones de CO2 por Tipo de Motor**

```{r}
ggplot(emisiones, aes(x = `engine_type`, y = `emissions_max_gCO2_km`, fill = `engine_type`)) +
  geom_boxplot() +
  labs(title = "Emisiones de CO2 por Tipo de Motor",
       x = "Tipo de Motor",
       y = "Emisiones Máximas (gCO2/km)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 
```

La gráfica muestra que el tipo de motor está claramente relacionado con las emisiones de CO2. Como era de esperar, los vehículos con motores eléctricos o híbridos no generan emisiones o emiten cantidades muy bajas, mientras que los motores de combustibles fósiles, como diésel y gasolina; tienen emisiones considerablemente más altas. Además, se observa una mayor cantidad de valores atípicos en estos tipos de motores, lo cual puede deberse a la amplia variedad de vehículos que utilizan combustibles fósiles.\
Aunque muchos de estos vehículos comparten características comunes, la presencia de valores extraños sugiere que algunos modelos presentan características especiales que les hacen consumir más combustible y, en consecuencia; generar más emisiones en comparación con los vehículos "típicos" de su categoría.


# **5. Tablas comparativas**

Utilizamos tablas comparativas para visualizar de una forma más directa la información del dataset.\
En este caso se han seleccionado las variables Tipo de vehículo, Transmisión y Cilindrada para ser estudiadas junto con Emisiones y Consumo, con el objetivo de visualizar qué tipos de vehículos contaminan más y cómo su tipo de transmisión y cilindrada son factores clave en el mismo ámbito.\
Para el cálculo de las tablas emplearemos los valores medios de cada variable cuantitativa, ya que si usásemos todos los del dataset quedarían tablas demasiado grandes y estas perderían su función de resumir la información.


**Tipos de vehículo vs Variables de rendimiento**

```{r}
tabla_comparativa <- emisiones %>%
  group_by(market_segment) %>%
  summarise(
    Consumo_Medio = mean(consumption_max_l_100km, na.rm = TRUE),
    Emisiones_Medias = mean(emissions_max_gCO2_km, na.rm = TRUE),
    Cilindrada_Media = mean(engine_displacement_cm3, na.rm = TRUE),
    .groups = 'drop')

kable(tabla_comparativa, 
      col.names = c("Segmento de Mercado", "Consumo Medio (l/100km)", "Emisiones Medias (g CO₂/km)", "Cilindrada Media (cm³)"),
      caption = "")

```

Con esta tabla podemos concluir que la mayoría de vehículos grandes (Camión, Furgón, Chasis-Cabina Grande) tienden a contaminar más que los pequeños, pues poseen valores mayores para el consumo de combustible y las emisiones.\
Esto confirma nuestros estudios previos relacionados con el área frontal y las emisiones máximas de los vehículos.

**Transmisión vs Consumo y Emisiones**

```{r}
tabla_comparativa1 <- emisiones %>%
  group_by(transmission) %>%
  summarise(
    Consumo_Medio = mean(consumption_max_l_100km, na.rm = TRUE),
    Emisiones_Medias = mean(emissions_max_gCO2_km, na.rm = TRUE),
    .groups = 'drop')

kable(tabla_comparativa1, 
      col.names = c("Transmisión", "Consumo Medio (l/100km)", "Emisiones Medias (g CO₂/km)"),
      caption = "")
```

En esta tabla visualizamos fácilmente como los vehículos de transmisión semiautomática (SC) consumen la mayor cantidad de combustible de todas las categorías y, sin embargo, son los que tienen transmisión automática (A) o manual (M) los que emiten más CO2.\
Esto sugiere que los coches más modernos como pueden ser los automáticos han conseguido un mejor ahorro del combustible, pero no rebajar la cantidad de emisiones al medio; mientras que los semiautomáticos son menos sostenibles, puesto que consumen grandes cantidades de combustible pese a emitir menos CO2.

**Cilindrada vs Consumo y Emisiones**

```{r}
tabla_comparativa2 <- emisiones %>%
  mutate(Cilindrada_Intervalos = cut(engine_displacement_cm3, 
                                     breaks = c(0, 1000, 2000, 3500, 6000, 8500, Inf),
                                     labels = c("Hasta 1000 cm³", "1000-2000 cm³", "2000-3500 cm³", "3500-6000 cm³", "6000-8500 cm³", "Más de 8500 cm³"))) %>%
  group_by(Cilindrada_Intervalos) %>%
  summarise(
    Consumo_Medio = mean(consumption_max_l_100km, na.rm = TRUE),
    Emisiones_Medias = mean(emissions_max_gCO2_km, na.rm = TRUE),
    .groups = 'drop')

kable(tabla_comparativa2, 
      col.names = c("Cilindrada del motor (Intervalos)", "Consumo Medio (l/100km)", "Emisiones Medias (g CO₂/km)"),
      caption = "")
```

Con esta tabla se nos confirma que existe una relación directamente proporcional entre el tamaño de la cilindrada y el consumo y emisiones del vehículo, de forma que a mayor cilindrada, mayores son los otros dos valores.\
Atendiendo a los números, los rangos de emisiones y consumo más altos se encuentran entre los 3000 y 8500 cm3, que revisando el dataset se corresponden con Camiones, Berlinas-familiares y Deportivos, entre otros.

# **6. Conclusiones**

## 6.1 Resumen de hallazgos clave

1. **Relación entre potencia y emisiones:** Se encontró una correlación negativa significativa entre la potencia del motor y las emisiones de CO2. Esto sugiere que a medida que aumenta la potencia, las emisiones de CO2 tienden a disminuir, lo que podría indicar que los vehículos más potentes están utilizando tecnologías más eficientes.
  
2. **Efecto del consumo:** Las emisiones de CO2 también mostraron una relación con el consumo de combustible, donde un menor consumo está asociado con menores emisiones. Esto destaca la importancia de la eficiencia energética en la reducción de emisiones contaminantes.

## 6.2 Recomendaciones

- **Fomentar la investigación en tecnología eficiente:** Se recomienda que los fabricantes de automóviles inviertan más en investigación y desarrollo de tecnologías que mejoren la eficiencia del combustible y reduzcan las emisiones de CO2.

- **Políticas ambientales:** Los responsables de las políticas deberían considerar la implementación de incentivos para vehículos que cumplan con estándares de baja emisión, así como promover el uso de energías limpias.

- **Educación del consumidor:** Los consumidores deben ser educados sobre la importancia de elegir vehículos con menor consumo de combustible y emisiones de CO2, para contribuir a un medio ambiente más saludable.

# **Autores**
Estudio realizado por:

- IRIS MUÑOZ MONTERO
- ÁNGEL YOUNES KARIM MÉRIDA
- CARLA CALVACHE AMADOR
- RUBÉN PEDROSO PRAENA
- MIGUEL GARCÍA FIGUEROA